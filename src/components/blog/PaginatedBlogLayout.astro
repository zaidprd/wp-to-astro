---
// src/components/blog/PaginatedBlogLayout.astro (PAGINASI DIPERBAIKI)

import Layout from '../../layouts/Layout.astro';
import BlogList from './BlogList.astro';
import InnerHero from '../sections/InnerHero.astro';
import Button from '../ui/Button.astro';
import { ChevronLeft, ChevronRight } from 'lucide-astro';
import blogHeroImage from '@assets/images/blog-hero-2.jpg';

const seoTitle = "Blog Jakobi";
const seoDescription = "Kumpulan artikel, wawasan, dan berita terbaru dari tim PT Jaya Konsultan Bisnis (Jakobi).";

interface Props {
    posts: any[];
    currentPage: number;
    totalPages: number;
    baseUrl: string;
    title: string;
    subtitle: string;
    currentCategory?: string;
}

const { 
    posts: paginatedPosts, 
    currentPage, 
    totalPages, 
    baseUrl,
    title,
    subtitle,
    currentCategory 
} = Astro.props;

const nextPage = currentPage < totalPages ? `${baseUrl}/${currentPage + 1}` : null;
const prevPage = currentPage > 1 ? (currentPage - 1 === 1 ? baseUrl : `${baseUrl}/${currentPage - 1}`) : null;

const heroContent = {
    title: title,
    description: subtitle,
    backgroundImage: blogHeroImage,
    overlayOpacity: 0.2
}

// --- LOGIKA BARU UNTUK MEMBUAT DAFTAR NOMOR HALAMAN ---
function getPaginationNumbers(currentPage: number, totalPages: number) {
    const pages = [];
    const delta = 2; // Berapa banyak nomor di sekitar halaman saat ini

    // Selalu tampilkan halaman pertama
    pages.push(1);

    // Tampilkan '...' jika perlu
    if (currentPage > delta + 2) {
        pages.push('...');
    }

    // Tampilkan nomor di sekitar halaman saat ini
    for (let i = Math.max(2, currentPage - delta); i <= Math.min(totalPages - 1, currentPage + delta); i++) {
        pages.push(i);
    }

    // Tampilkan '...' jika perlu
    if (currentPage < totalPages - delta - 1) {
        pages.push('...');
    }

    // Selalu tampilkan halaman terakhir (jika lebih dari 1 halaman)
    if (totalPages > 1) {
        pages.push(totalPages);
    }

    return pages;
}

const paginationNumbers = getPaginationNumbers(currentPage, totalPages);
---
<Layout title={seoTitle} description={seoDescription}>
    <main>
        <InnerHero content={heroContent}/>

        <section class="py-base md:py-large">
            <div class="container mx-auto px-4">
                
                <BlogList posts={paginatedPosts} currentCategory={currentCategory} />

                {totalPages > 1 && (
                    <nav class="pagination-nav mt-16" aria-label="Blog pagination" data-aos="fade-in">
                        <div class="flex items-center justify-center gap-2 sm:gap-4">
                            {prevPage && (
                                <Button href={prevPage} variant="primary" class="flex items-center gap-2">
                                    <ChevronLeft size={20} />
                                    Prev
                                </Button>
                            )}
                            
                            {/* --- BAGIAN INI DIUBAH UNTUK MENGGUNAKAN LOGIKA BARU --- */}
                            <div class="hidden sm:flex items-center gap-2">
                                {paginationNumbers.map((pageNum) => (
                                    typeof pageNum === 'number' ? (
                                        <a
                                            href={pageNum === 1 ? baseUrl : `${baseUrl}/${pageNum}`}
                                            class={`w-10 h-10 flex items-center justify-center rounded-full transition-colors ${
                                                currentPage === pageNum
                                                    ? 'bg-primary text-white'
                                                    : 'hover:bg-white hover:text-body-base'
                                            }`}
                                            aria-current={currentPage === pageNum ? 'page' : undefined}
                                        >
                                            {pageNum}
                                        </a>
                                    ) : (
                                        <span class="w-10 h-10 flex items-center justify-center">...</span>
                                    )
                                ))}
                            </div>
                            {/* Tampilkan info halaman di mobile */}
                            <div class="sm:hidden text-sm">
                                Page {currentPage} of {totalPages}
                            </div>

                            {nextPage && (
                                <Button href={nextPage} variant="primary" class="flex items-center gap-2">
                                    Next
                                    <ChevronRight size={20} />
                                </Button>
                            )}
                        </div>
                    </nav>
                )}
            </div>
        </section>
    </main>
</Layout>
