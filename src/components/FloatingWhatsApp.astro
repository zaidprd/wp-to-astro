---
// src/components/FloatingWhatsApp.astro (Versi dengan teks muncul saat scroll)

const phoneNumber = "6281274203815"; 
const defaultMessage = "Halo%20Jakobi%2C%20boleh%20bantu%20kami%20untuk%20pembuatan%20feasibility%20study%3F";
const whatsappLink = `https://wa.me/${phoneNumber}?text=${defaultMessage}`;
---

<!-- 
    PERUBAHAN 1: Bungkus semuanya dalam satu div 'container' 
    untuk mengelola posisi dan interaksi secara bersamaan.
-->
<div id="whatsapp-container" class="whatsapp-container">
    <a 
        href={whatsappLink}
        target="_blank" 
        rel="noopener noreferrer"
        aria-label="Hubungi kami via WhatsApp"
        class="whatsapp-link"
    >
        <!-- 
            PERUBAHAN 2: Tambahkan elemen span untuk teks 
            yang akan muncul dan menghilang.
        -->
        <span id="whatsapp-text" class="whatsapp-text">
            Hubungi Segera
        </span>

        <!-- Ikon WhatsApp tetap sama -->
        <div class="whatsapp-icon-wrapper">
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 448 512"
                class="whatsapp-icon"
                aria-hidden="true"
                fill="currentColor"
            >
                <path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.8 0-65.7-10.8-94.2-30.6l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/>
            </svg>
        </div>
    </a>
</div>

<!-- 
    PERUBAHAN 3: Tambahkan <script> untuk logika scroll 
    dan <style> untuk animasi dan layout baru.
-->
<script>
    // Ambil elemen dari DOM
    const whatsappContainer = document.getElementById('whatsapp-container' );
    const whatsappText = document.getElementById('whatsapp-text');

    // Tentukan seberapa jauh pengguna harus scroll sebelum teks muncul (dalam piksel)
    const scrollThreshold = 200; 

    // Fungsi untuk memeriksa posisi scroll
    function handleScroll() {
        if (window.scrollY > scrollThreshold) {
            // Jika sudah scroll cukup jauh, tambahkan class 'show'
            whatsappContainer?.classList.add('show-text');
        } else {
            // Jika kembali ke atas, hapus class 'show'
            whatsappContainer?.classList.remove('show-text');
        }
    }

    // Tambahkan event listener untuk event 'scroll'
    window.addEventListener('scroll', handleScroll, { passive: true });
</script>

<style>
    /* Container utama untuk tombol dan teks */
    .whatsapp-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        align-items: center;
    }

    /* Link yang membungkus semuanya */
    .whatsapp-link {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: white;
    }

    /* Styling untuk teks "Hubungi Segera" */
    .whatsapp-text {
        background-color: white;
        color: #128C7E; /* Warna hijau tua WhatsApp */
        padding: 8px 16px;
        border-radius: 16px;
        margin-right: -15px; /* Agar sedikit tumpang tindih dengan ikon */
        font-size: 14px;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        
        /* Sembunyikan teks secara default */
        opacity: 0;
        transform: translateX(20px);
        transition: opacity 0.4s ease, transform 0.4s ease;
        white-space: nowrap; /* Mencegah teks turun baris */
    }

    /* Styling untuk lingkaran ikon WhatsApp */
    .whatsapp-icon-wrapper {
        width: 60px;
        height: 60px;
        background-color: #25D366;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
        z-index: 2; /* Pastikan ikon di atas teks */
    }

    .whatsapp-icon {
        width: 32px;
        height: 32px;
    }

    /* Efek hover pada seluruh container */
    .whatsapp-container:hover .whatsapp-icon-wrapper {
        transform: scale(1.1);
    }

    /* Class 'show-text' yang akan ditambahkan oleh JavaScript */
    .whatsapp-container.show-text .whatsapp-text {
        opacity: 1;
        transform: translateX(0);
    }
</style>
